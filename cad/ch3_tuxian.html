<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>第三讲 图线处理</title>
    <!-- css -->
    <link rel="stylesheet" href="libs/katex/katex.min.css">
    <link rel="stylesheet" href="libs/pseudocode/pseudocode.min.css">
    <link rel="stylesheet" href="libs/SyntaxHighlighter/styles/shCoreDefault.css" />
    <link rel="stylesheet" href="css/style.css">
    <!-- javascript libs -->
    <script src="libs/mathjs/math.min.js"></script>
    <script src="libs/katex/katex.min.js"></script>
    <script type="text/javascript" src="libs/SyntaxHighlighter/scripts/shCore.js"></script>
    <script type="text/javascript" src="libs/SyntaxHighlighter/scripts/shBrushJScript.js"></script>
    <script src="libs/d3/d3.min.js"></script>
    <script src="libs/function-plot/dist/function-plot.js"></script>

    <script src="libs/pseudocode/pseudocode.min.js"></script>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>
</head>

<body>
    <h1>3 图线处理</h1>
    <h2>3.0 HTML中用JavaScript来进行2D绘图</h2>
    <h3>[1]. HTML5中canvas 元素用于在网页上绘制图形</h3>
    <dt> canvas 元素</dt>
    <dd>canvas（画布）是一个矩形区域，可以控制其每一像素。canvas 拥有多种绘制路径、矩形、圆形、字符以及添加图像的方法。</dd>
    <dt>创建 Canvas 元素</dt>
    <dd>向 HTML5 页面添加 canvas 元素。规定元素的 id、宽度和高度：</dd>
    <pre class="brush:js;"> 
        &lt;canvas id="myCanvas" width="200px" height="100px"&gt;&lt;/canvas&gt;
    </pre>
    <dt>通过 JavaScript 来绘制</dt>
    <dd>canvas 元素本身是没有绘图能力的。所有的绘制工作必须在 JavaScript 内部完成：</dd>
    <pre class="brush:js;">
        &lt;script type="text/javascript"&gt;
            var c=document.getElementById("myCanvas"); //使用 id 来寻找 canvas 元素
            var cxt=c.getContext("2d");                //创建 context 对象
            cxt.fillStyle="#FF0000";                   //绘制一个红色的矩形
            cxt.fillRect(0,0,150,75);                  //左上角坐标（0，0），宽：150，高：75
        &lt;/script&gt;
    </pre>
    <canvas id="myCanvas" width="200" height="100"></canvas>
    <script type="text/javascript">
        var c = document.getElementById("myCanvas");
        var cxt = c.getContext("2d");
        cxt.fillStyle = "#FF0000";
        cxt.fillRect(0, 0, 150, 75);
    </script>
    <dt>理解坐标</dt>
    <dd>在缺省的canvas坐标中，从左到右是x的正方向，从上到下是y的正方向，坐标原点在左上角。</dd>
    <canvas id="coordiv" style="float:left;width:199px;height:99px;border:1px solid #c3c3c3" onmousemove="cnvs_getCoordinates(event)" onmouseout="cnvs_clearCoordinates()"></canvas>
    <br />
    <br />
    <br />
    <div id="xycoordinates"></div>
    <script type="text/javascript">
        function cnvs_getCoordinates(evt) {
            var canvas = document.getElementById("coordiv");
            var rect = canvas.getBoundingClientRect();
            x = math.round((evt.clientX - rect.left) / (rect.right - rect.left) * canvas.width);
            y = math.round((evt.clientY - rect.top) / (rect.bottom - rect.top) * canvas.height);
            document.getElementById("xycoordinates").innerHTML = "Coordinates: (" + x + "," + y + ")";
        }

        function cnvs_clearCoordinates() {
            document.getElementById("xycoordinates").innerHTML = "";
        }
    </script>
    <dt>常见绘图操作</dt>
    <dd>下面的程序绘制了：直线段、圆（弧）、矩形。注意，对于直线段、圆（弧）来说，必须先包含在一个path中，而矩形则可以自己绘制。</dd>
    <draw-box class="float:left;">
        <canvas width="1000px" height="400px" id="绘图示例2"></canvas>
    </draw-box>
    <script>
        var ctx = document.getElementById("绘图示例2").getContext("2d");
        ctx.save();

        ctx.beginPath();
        ctx.lineWidth = 4; //设置线段宽度
        ctx.arc(100, 75, 50, 0, 2 * Math.PI);
        ctx.stroke();

        ctx.lineWidth = 15; //设置线段宽度

        ctx.beginPath();
        ctx.lineCap = "round"; //设置直线结束线帽: 圆
        ctx.lineJoin = "round"; //设置折线边角：圆角
        ctx.strokeStyle = "rgb(255,0,0)";
        ctx.moveTo(20, 220);
        ctx.lineTo(220, 220);
        ctx.lineTo(100, 185);
        ctx.arc(100, 75, 110, 90 * Math.PI / 180, 0, true); //画圆弧，圆心[100,75],半径100,开始角90°,结束角0°，逆时针，
        //注意y轴正向向下，所以90°是向下的。
        ctx.stroke();

        ctx.beginPath();
        ctx.lineCap = "butt"; //设置直线结束线帽： 缺省
        ctx.lineJoin = "bevel"; //设置折线边角：斜角
        ctx.strokeStyle = "rgb(0,255,0)";
        ctx.fillStyle = "rgba(120,45,230,0.8)"; //设置带透明度的填充色
        ctx.moveTo(20, 280);
        ctx.lineTo(220, 280);
        ctx.lineTo(30, 180);
        ctx.closePath();
        ctx.fill();
        ctx.stroke();

        ctx.beginPath();
        ctx.lineCap = "square"; //设置直线结束线帽：方形（突出）
        ctx.lineJoin = "miter"; //设置折线边角：尖角（缺省）
        ctx.strokeStyle = "rgb(0,0,255)";
        ctx.moveTo(20, 340);
        ctx.lineTo(220, 340);
        ctx.lineTo(80, 300);
        ctx.stroke();

        function draw_平键(ctx, x, y, width, length, angle, strock_width, strock_color, fill_color) {
            ctx.save();
            ctx.beginPath();
            ctx.strokeStyle = strock_color;
            ctx.lineCap = "round";
            ctx.lineJoin = "round";
            ctx.fillStyle = fill_color;
            ctx.lineWidth = strock_width;
            ctx.translate(x, y);
            ctx.rotate(angle * Math.PI / 180.0);
            ctx.moveTo(0, width / 2);
            ctx.arc(0, 0, width / 2, 90 * Math.PI / 180.0, -90 * Math.PI / 180.0, false);
            ctx.lineTo(length, -width / 2);
            ctx.lineTo(length, width / 2);
            ctx.lineTo(0, width / 2);
            ctx.fill();
            ctx.stroke();
            ctx.restore();
        }

        var dx = 300,
            dy = 80,
            width = 50,
            length = 80;
        for (var i = 0; i < 4; i++) {
            draw_平键(ctx, dx + i * 2 * length, dy, width, length, 0, 5, "black", "yellow");
        }
        for (var i = 0; i < 4; i++) {
            draw_平键(ctx, dx + i * 2 * length, dy + 200, width, length, i * 90, 5, "black", "red");
        }
    </script>
    <div class="code-box;">
        <pre class="brush:js;">
            &lt;canvas width="400px" height="400px" id="绘图示例2"&gt;&lt;/canvas&gt;
            &lt;script&gt;
            var ctx = document.getElementById("绘图示例2").getContext("2d");
            ctx.save();
    
            ctx.beginPath();
            ctx.lineWidth = 4; //设置线段宽度
            ctx.arc(100, 75, 50, 0, 2 * Math.PI);
            ctx.stroke();
    
            ctx.lineWidth = 15; //设置线段宽度
    
            ctx.beginPath();
            ctx.lineCap = "round"; //设置直线结束线帽: 圆
            ctx.lineJoin = "round"; //设置折线边角：圆角
            ctx.strokeStyle = "rgb(255,0,0)";
            ctx.moveTo(20, 220);
            ctx.lineTo(220, 220);
            ctx.lineTo(100, 185);
            ctx.arc(100, 75, 110, 90 * Math.PI / 180, 0, true); //画圆弧，圆心[100,75],半径100,开始角90°,结束角0°，逆时针，
            //注意y轴正向向下，所以90°是向下的。
            ctx.stroke();
    
            ctx.beginPath();
            ctx.lineCap = "butt"; //设置直线结束线帽： 缺省
            ctx.lineJoin = "bevel"; //设置折线边角：斜角
            ctx.strokeStyle = "rgb(0,255,0)";
            ctx.fillStyle = "rgba(120,45,230,0.8)"; //设置带透明度的填充色
            ctx.moveTo(20, 280);
            ctx.lineTo(220, 280);
            ctx.lineTo(30, 180);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
    
            ctx.beginPath();
            ctx.lineCap = "square"; //设置直线结束线帽：方形（突出）
            ctx.lineJoin = "miter"; //设置折线边角：尖角（缺省）
            ctx.strokeStyle = "rgb(0,0,255)";
            ctx.moveTo(20, 340);
            ctx.lineTo(220, 340);
            ctx.lineTo(80, 300);
            ctx.stroke();
    
            function draw_平键(ctx, x, y, width, length, angle, strock_width, strock_color, fill_color) {
                ctx.save();
                ctx.beginPath();
                ctx.strokeStyle = strock_color;
                ctx.lineCap = "round";
                ctx.lineJoin = "round";
                ctx.fillStyle = fill_color;
                ctx.lineWidth = strock_width;
                ctx.translate(x, y);
                ctx.rotate(angle * Math.PI / 180.0);
                ctx.moveTo(0, width / 2);
                ctx.arc(0, 0, width / 2, 90 * Math.PI / 180.0, -90 * Math.PI / 180.0, false);
                ctx.lineTo(length, -width / 2);
                ctx.lineTo(length, width / 2);
                ctx.lineTo(0, width / 2);
                ctx.fill();
                ctx.stroke();
                ctx.restore();
            }
    
            var dx = 300,
                dy = 80,
                width = 50,
                length = 80;
            for (var i = 0; i < 4; i++) {
                draw_平键(ctx, dx + i * 2 * length, dy, width, length, 0, 5, "black", "yellow");
            }
            for (var i = 0; i < 4; i++) {
                draw_平键(ctx, dx + i * 2 * length, dy + 200, width, length, i * 90, 5, "black", "red");
            }
            &lt;/script&gt;
        </pre>
    </div>
    <h2>3.1 直线处理</h2>
</body>

</html>